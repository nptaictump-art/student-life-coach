{% extends "base.html" %}
{% block content %}
<div class="max-w-6xl mx-auto py-10 px-4">
    <!-- Header -->
    <div class="text-center mb-10">
        <h1 class="text-4xl font-extrabold text-indigo-700 mb-2 flex items-center justify-center gap-2">
            ğŸ“ Student Life Coach
        </h1>
        <p class="text-gray-600">Há»c Ä‘á»u â€“ Äáº¡t Ä‘iá»ƒm cao â€“ Giá»¯ lá»­a Ä‘am mÃª! ğŸŒŸ</p>
    </div>

    <!-- User stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center border-t-4 border-yellow-400">
            <div class="text-4xl font-bold text-yellow-500 mb-2">{{ user.streak }} ğŸ”¥</div>
            <p class="text-gray-700 font-medium">Chuá»—i ngÃ y há»c</p>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center border-t-4 border-green-500">
            <div class="text-4xl font-bold text-green-600 mb-2">{{ user.total_points }} ğŸ†</div>
            <p class="text-gray-700 font-medium">Tá»•ng Ä‘iá»ƒm</p>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center border-t-4 border-blue-500">
            <div class="text-4xl font-bold text-blue-600 mb-2">{{ completion_rate }}%</div>
            <p class="text-gray-700 font-medium">HoÃ n thÃ nh tuáº§n nÃ y</p>
        </div>
    </div>

    <!-- Google Calendar Connection -->
    <div class="text-center mb-8">
        {% if authenticated %}
            <div class="flex justify-center items-center gap-4 mb-4">
                <i class="fa-solid fa-calendar-check text-green-600 text-2xl"></i>
                <span class="text-lg font-semibold text-green-700">
                    âœ… ÄÃ£ káº¿t ná»‘i Google Calendar ({{ session.google_email }})
                </span>
            </div>
            <a href="{{ url_for('logout_google') }}"
               class="inline-flex items-center bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-full shadow-md transition transform hover:scale-105">
               <i class="fa-solid fa-right-from-bracket mr-2"></i> Ngáº¯t káº¿t ná»‘i
            </a>
        {% else %}
            <div class="flex justify-center items-center gap-4 mb-4">
                <i class="fa-regular fa-calendar-xmark text-yellow-500 text-2xl"></i>
                <span class="text-lg font-semibold text-yellow-600">
                    âš ï¸ ChÆ°a káº¿t ná»‘i Google Calendar
                </span>
            </div>
            <a href="{{ url_for('authorize') }}"
               class="inline-flex items-center bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-full shadow-md transition transform hover:scale-105">
               <i class="fa-brands fa-google mr-2"></i> ğŸ”— Káº¿t ná»‘i Google Calendar
            </a>
        {% endif %}
    </div>

    <!-- Weekly Events -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-10">
        <div class="flex items-center gap-2 mb-4">
            <i class="fa-solid fa-calendar-week text-indigo-600 text-2xl"></i>
            <h2 class="text-2xl font-bold text-indigo-700">ğŸ“… Lá»‹ch há»c & sá»± kiá»‡n trong 7 ngÃ y tá»›i</h2>
        </div>

        {% if events %}
            <ul class="divide-y divide-gray-200">
                {% for event in events %}
                    <li class="py-4 flex justify-between items-center">
                        <div>
                            <p class="font-semibold text-gray-800">
                                {{ event.summary or "(KhÃ´ng cÃ³ tiÃªu Ä‘á»)" }}
                            </p>
                            {% if event.start.dateTime %}
                                <p class="text-sm text-gray-500">
                                    {{ event.start.dateTime|replace("T", " ")|replace("Z", "") }}
                                    â†’ {{ event.end.dateTime|replace("T", " ")|replace("Z", "") }}
                                </p>
                            {% else %}
                                <p class="text-sm text-gray-500">
                                    {{ event.start.date }} (Cáº£ ngÃ y)
                                </p>
                            {% endif %}
                        </div>
                        <a href="{{ event.htmlLink }}" target="_blank"
                           class="text-indigo-600 hover:text-indigo-800 text-sm font-semibold flex items-center gap-1">
                            Xem <i class="fa-solid fa-arrow-up-right-from-square"></i>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-gray-500 italic text-center py-6">
                KhÃ´ng cÃ³ sá»± kiá»‡n nÃ o trong tuáº§n nÃ y. HÃ£y thÃªm lá»‹ch há»c má»›i nhÃ©! âœï¸
            </p>
        {% endif %}
    </div>

    <!-- Chart: 7-day progress -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-10">
        <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
            <i class="fa-solid fa-chart-column text-indigo-500"></i>
            Tiáº¿n Ä‘á»™ há»c táº­p 7 ngÃ y qua
        </h2>
        <canvas id="progressChart" height="100"></canvas>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col md:flex-row justify-center gap-6 mt-8">
        <a href="{{ url_for('add_event') }}"
           class="inline-flex items-center bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-8 py-3 rounded-full shadow-md transition transform hover:scale-105">
           <i class="fa-solid fa-calendar-plus mr-2"></i> â• ThÃªm Lá»‹ch Há»c
        </a>

        <a href="{{ url_for('mark_complete') }}"
           class="inline-flex items-center bg-green-600 hover:bg-green-700 text-white font-semibold px-8 py-3 rounded-full shadow-md transition transform hover:scale-105">
           <i class="fa-solid fa-fire mr-2"></i> ÄÃ¡nh Dáº¥u HoÃ n ThÃ nh
        </a>

        <a href="{{ url_for('generate_quiz') }}"
           class="inline-flex items-center bg-purple-600 hover:bg-purple-700 text-white font-semibold px-8 py-3 rounded-full shadow-md transition transform hover:scale-105">
           <i class="fa-solid fa-question mr-2"></i> ğŸ§  LÃ m Quiz AI
        </a>
    </div>

    <!-- Upload Excel Section -->
    {% if authenticated %}
    <div class="mt-10 text-center text-gray-700 bg-indigo-50 rounded-xl py-6 shadow-inner">
        <p class="text-lg font-semibold mb-2 text-indigo-700">ğŸ“¤ Táº¡o lá»‹ch há»c tá»± Ä‘á»™ng</p>
        <p>
            <a href="{{ url_for('upload') }}"
               class="text-indigo-600 hover:text-indigo-800 underline font-medium">Táº£i file Excel Ä‘á»ƒ táº¡o lá»‹ch há»c tá»± Ä‘á»™ng</a>
        </p>
        <p>
            <a href="{{ url_for('download_template') }}"
               class="text-indigo-600 hover:text-indigo-800 underline font-medium">ğŸ“„ Táº£i máº«u Excel import lá»‹ch há»c</a>
        </p>
    </div>
    {% endif %}

    <!-- Encouragement -->
    <div class="mt-10 text-center text-gray-700">
        {% if user.streak >= 7 %}
            <p class="text-lg font-semibold text-green-600 animate-bounce">
                ğŸŒŸ Tuyá»‡t vá»i! Báº¡n Ä‘Ã£ há»c Ä‘á»u 7 ngÃ y rá»“i!
            </p>
        {% elif user.streak > 0 %}
            <p class="text-lg">ğŸš€ Tiáº¿p tá»¥c nhÃ©! CÃ²n {{ 7 - user.streak }} ngÃ y ná»¯a Ä‘á»ƒ Ä‘áº¡t streak vÃ ng!</p>
        {% else %}
            <p class="text-lg text-red-500">ğŸ”¥ Báº¯t Ä‘áº§u chuá»—i há»c ngay hÃ´m nay Ä‘á»ƒ nháº­n Ä‘iá»ƒm thÆ°á»Ÿng!</p>
        {% endif %}
    </div>
</div>

<!-- Chart.js -->
<script>
// Chuyá»ƒn dá»¯ liá»‡u tá»« Jinja2 sang JavaScript má»™t cÃ¡ch an toÃ n
const chartDays = {{ days|tojson|safe }};
const chartCounts = {{ counts|tojson|safe }};

const ctx = document.getElementById('progressChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: chartDays,
        datasets: [{
            label: 'Sá»‘ buá»•i há»c',
            data: chartCounts,
            backgroundColor: '#6366f1',
            borderColor: '#4f46e5',
            borderWidth: 1,
            borderRadius: 8
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { stepSize: 1 },
                grid: { color: '#e5e7eb' }
            },
            x: { grid: { display: false } }
        }
    }
});
</script>
{% endblock %}